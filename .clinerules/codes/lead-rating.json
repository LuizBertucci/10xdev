{
    "title": "Sistema de Lead Rating - Gestão de Leads",
    "tech": "Next.js + Node.js",
    "language": "typescript",
    "description": "Sistema completo de avaliação de potencial de leads com escala de 1 a 5 estrelas, incluindo filtros, visualização em cards, edição inline e no modal de detalhes, validação backend e persistência no banco de dados",
    "content_type": "code",
    "card_type": "codigos",
    "screens": [
      {
        "name": "Lead Filters Component",
        "description": "Componente de filtros com chips de rating (1-5 estrelas) para filtrar leads por potencial",
        "route": "frontend/src/components/lead-filters.tsx",
        "blocks": [
          {
            "id": "block-1",
            "type": "code",
            "content": "'use client'\n\nimport React from 'react'\nimport { Input } from '@/components/ui/input'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Button } from '@/components/ui/button'\nimport { Search, Star } from 'lucide-react'\nimport { AddLeadSheet } from '@/components/add-lead-sheet'\nimport { CreateLeadPayload } from '@/services/contacts-api'\nimport type { Profile } from '@/services/team-api'\n\ninterface LeadFiltersProps {\n  searchTerm: string\n  onSearchChange: (value: string) => void\n  categoryFilter: string\n  onCategoryFilterChange: (value: string) => void\n  consultorFilter: string\n  onConsultorFilterChange: (value: string) => void\n  ratingFilter: string\n  onRatingFilterChange: (value: string) => void\n  team: Profile[]\n  currentProfile: Profile | null\n  onCreateLead: (data: CreateLeadPayload) => Promise<void>\n}\n\nexport function LeadFilters({\n  searchTerm,\n  onSearchChange,\n  categoryFilter,\n  onCategoryFilterChange,\n  consultorFilter,\n  onConsultorFilterChange,\n  ratingFilter,\n  onRatingFilterChange,\n  team,\n  currentProfile,\n  onCreateLead,\n}: LeadFiltersProps) {\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex gap-4 items-center\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n          <Input\n            placeholder=\"Buscar por nome, email ou telefone...\"\n            value={searchTerm}\n            onChange={(e) => onSearchChange(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        <AddLeadSheet onCreateLead={onCreateLead} />\n      </div>\n\n      <div className=\"flex gap-4 items-center\">\n        <div className=\"flex gap-2 items-center\">\n          <Button\n            variant={categoryFilter === 'all' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => onCategoryFilterChange('all')}\n          >\n            Todas\n          </Button>\n          <Button\n            variant={categoryFilter === 'prospeccao' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => onCategoryFilterChange('prospeccao')}\n          >\n            Prospecção\n          </Button>\n          <Button\n            variant={categoryFilter === 'vendas' ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => onCategoryFilterChange('vendas')}\n          >\n            Vendas\n          </Button>\n          \n          <div className=\"h-6 w-px bg-border mx-2\" />\n\n          {/* Rating chips */}\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant={ratingFilter === 'all' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => onRatingFilterChange('all')}\n            >\n              Todas\n            </Button>\n            {[1,2,3,4,5].map(n => (\n              <Button\n                key={n}\n                variant={ratingFilter === String(n) ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => onRatingFilterChange(String(n))}\n                className=\"inline-flex items-center gap-1\"\n              >\n                {n}\n                <Star className=\"h-3.5 w-3.5 fill-amber-400 text-amber-500\" />\n              </Button>\n            ))}\n          </div>\n\n          <div className=\"h-6 w-px bg-border mx-2\" />\n\n          <Select value={consultorFilter} onValueChange={onConsultorFilterChange}>\n            <SelectTrigger className=\"w-[280px] h-8 py-0 px-3 border-primary/50 focus:border-primary text-sm\">\n              <SelectValue placeholder=\"Filtrar por consultor\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Todos os Consultores</SelectItem>\n              {currentProfile && (\n                <SelectItem value=\"mine\">Meus Leads</SelectItem>\n              )}\n              <SelectItem value=\"unassigned\">Sem Consultor</SelectItem>\n              {team\n                .filter(member => member.status === 'active')\n                .map(member => (\n                  <SelectItem key={member.id} value={member.id}>\n                    {member.name}\n                  </SelectItem>\n                ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n    </div>\n  )\n}",
            "language": "typescript",
            "title": "Lead Filters with Rating",
            "order": 1
          }
        ]
      },
      {
        "name": "Lead Column Card",
        "description": "Card visual que exibe o lead em colunas kanban com badge de rating em destaque para leads com potencial >= 4 estrelas",
        "route": "frontend/src/components/lead-column-card.tsx",
        "blocks": [
          {
            "id": "block-2",
            "type": "code",
            "content": "import React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Contact } from '@/services/contacts-api';\nimport { format } from 'date-fns';\nimport { ptBR } from 'date-fns/locale';\nimport { ArrowRight, AlertTriangle, Banknote, Star } from 'lucide-react';\n\ninterface LeadColumnCardProps {\n  contact: Contact;\n  valueOverride?: number;\n}\n\nexport function LeadColumnCard({ contact, valueOverride }: LeadColumnCardProps) {\n  const formatDate = (dateString: string) => {\n    try {\n      const date = new Date(dateString);\n      return format(date, \"dd 'de' MMM 'de' yyyy\", { locale: ptBR });\n    } catch {\n      return '';\n    }\n  };\n\n  const valorCalculado = (typeof contact.valor_projeto === 'number')\n    ? contact.valor_projeto\n    : (contact.tipo_contato === 'cliente' && contact.valorTotalContratado\n      ? contact.valorTotalContratado\n      : 0);\n  const valor = typeof valueOverride === 'number' ? valueOverride : valorCalculado;\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(value);\n  };\n\n  const getStatusIcon = () => {\n    if (contact.status_lead === 'perdido' || contact.status_lead === 'no_show') {\n      return (\n        <div className=\"flex items-center justify-center\">\n          <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />\n        </div>\n      );\n    }\n    const isUrgent = contact.status_lead === 'documentacao' || contact.status_lead === 'green_flag' || contact.status_lead === 'proposta_enviada';\n    return (\n      <div className={`rounded-full flex items-center justify-center ${isUrgent ? 'bg-red-500' : 'bg-gray-400'}`} style={{ width: '20px', height: '20px' }}>\n        <ArrowRight className=\"h-3 w-3 text-white\" />\n      </div>\n    );\n  };\n\n  return (\n    <Card className=\"w-full mb-2 hover:shadow-md transition-shadow bg-white border border-gray-200\">\n      <CardContent className=\"p-3\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex-1 min-w-0\">\n            {/* Nome + badge de rating (quando >=4) */}\n            <div className=\"font-semibold text-sm mb-1 text-gray-900\">\n              <div className=\"flex items-center gap-2 min-w-0\">\n                {typeof contact.lead_rating === 'number' && contact.lead_rating >= 4 ? (\n                  <span\n                    title={`Potencial do lead: ${contact.lead_rating}/5`}\n                    className=\"inline-flex items-center rounded-md px-1.5 py-0.5 text-[10px] font-bold border border-amber-300 bg-amber-50 text-amber-800 flex-shrink-0\"\n                  >\n                    <Star className=\"h-3 w-3 mr-1 fill-amber-400 text-amber-500\" />\n                    {contact.lead_rating}\n                  </span>\n                ) : null}\n                <span className=\"truncate\">{contact.nome}</span>\n              </div>\n            </div>\n            \n            <div className=\"text-xs text-gray-600 mb-1.5\">\n              {formatDate(contact.created_at)}\n            </div>\n\n            {valor > 0 && (\n              <div className=\"inline-flex items-center gap-1 rounded-md border border-emerald-300 bg-emerald-50 px-2 py-1 mt-0.5 text-emerald-800 text-xs font-semibold\">\n                <Banknote className=\"h-3 w-3\" />\n                {formatCurrency(valor)}\n              </div>\n            )}\n            {valor === 0 && contact.tipo_contato === 'cliente' && (\n              <div className=\"inline-flex items-center gap-1 rounded-md border border-gray-300 bg-gray-50 px-2 py-1 text-gray-600 text-xs font-medium\">\n                <Banknote className=\"h-3 w-3\" />\n                R$ 0\n              </div>\n            )}\n          </div>\n          \n          <div className=\"flex-shrink-0 mt-0.5\">\n            {getStatusIcon()}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}",
            "language": "typescript",
            "title": "Lead Card with Rating Badge",
            "order": 1
          }
        ]
      },
      {
        "name": "Lead Modal - Rating Editor",
        "description": "Modal completo de detalhes do lead com editor de rating (dropdown 1-5), permitindo edição inline e no modo de edição completa",
        "route": "frontend/src/components/lead-modal.tsx",
        "blocks": [
          {
            "id": "block-3",
            "type": "code",
            "content": "'use client'\n\nimport React, { useState, useEffect } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Label } from '@/components/ui/label'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Edit, Save, X, Archive } from 'lucide-react'\nimport { Contact, LEAD_STATUS, TIPO_CONSORCIO_OPTIONS } from '@/services/api'\nimport { useTeam } from '@/hooks/useTeam'\nimport { ActivityTimeline } from '@/components/activity-timeline'\n\nexport interface LeadModalProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  lead: Contact\n  onUpdate: (id: number, data: Partial<Contact>) => Promise<void> | void\n  onRequestConvertWithCotas: (lead: Contact) => void\n  loading?: boolean\n}\n\nexport function LeadModal({ open, onOpenChange, lead, onUpdate, onRequestConvertWithCotas, loading = false }: LeadModalProps) {\n  const { team } = useTeam()\n  const [isEditingInfo, setIsEditingInfo] = useState(false)\n  const [consultorResponsavel, setConsultorResponsavel] = useState<string>(lead.consultor_responsavel || 'unassigned')\n  const [editedLead, setEditedLead] = useState<{\n    nome: string\n    email: string\n    celular: string\n    origem: string\n    tipo_consorcio: Contact['tipo_consorcio'] | ''\n    valor_projeto: number | null\n    lead_rating: number | null\n  }>({\n    nome: lead.nome || '',\n    email: lead.email || '',\n    celular: lead.celular || '',\n    origem: lead.origem || '',\n    tipo_consorcio: lead.tipo_consorcio || '',\n    valor_projeto: typeof lead.valor_projeto === 'number' ? lead.valor_projeto : null,\n    lead_rating: typeof lead.lead_rating === 'number' ? lead.lead_rating : null,\n  })\n\n  useEffect(() => {\n    setConsultorResponsavel(lead.consultor_responsavel || 'unassigned')\n  }, [lead.id, lead.consultor_responsavel])\n\n  const consultorSelecionado = React.useMemo(() => {\n    if (consultorResponsavel === 'unassigned') return 'Não atribuído'\n    const consultor = team.find(m => m.id === consultorResponsavel)\n    return consultor?.name || 'Não atribuído'\n  }, [consultorResponsavel, team])\n\n  useEffect(() => {\n    setEditedLead({\n      nome: lead.nome || '',\n      email: lead.email || '',\n      celular: lead.celular || '',\n      origem: lead.origem || '',\n      tipo_consorcio: lead.tipo_consorcio || '',\n      valor_projeto: typeof lead.valor_projeto === 'number' ? lead.valor_projeto : null,\n      lead_rating: typeof lead.lead_rating === 'number' ? lead.lead_rating : null,\n    })\n  }, [lead])\n\n  if (!open) return null\n\n  const startEditingInfo = () => {\n    setIsEditingInfo(true)\n  }\n\n  const saveLeadInfo = async () => {\n    const tipoConsorcio = editedLead.tipo_consorcio === '' \n      ? undefined \n      : (editedLead.tipo_consorcio as Contact['tipo_consorcio'])\n    \n    const updateData: Partial<Contact> = {\n      nome: editedLead.nome,\n      email: editedLead.email,\n      celular: editedLead.celular,\n      origem: editedLead.origem,\n      tipo_consorcio: tipoConsorcio,\n      valor_projeto: editedLead.valor_projeto === null ? null : editedLead.valor_projeto,\n      lead_rating: editedLead.lead_rating === null ? null : editedLead.lead_rating,\n    }\n    \n    const hasChanges = (\n      (updateData.nome || '') !== (lead.nome || '') ||\n      (updateData.email || '') !== (lead.email || '') ||\n      (updateData.celular || '') !== (lead.celular || '') ||\n      (updateData.origem || '') !== (lead.origem || '') ||\n      (updateData.tipo_consorcio || '') !== (lead.tipo_consorcio || '') ||\n      (updateData.valor_projeto ?? null) !== (typeof lead.valor_projeto === 'number' ? lead.valor_projeto : null) ||\n      (updateData.lead_rating ?? null) !== (typeof lead.lead_rating === 'number' ? lead.lead_rating : null)\n    )\n\n    if (!hasChanges) {\n      setIsEditingInfo(false)\n      onOpenChange(false)\n      return\n    }\n\n    await onUpdate(lead.id, updateData)\n    setIsEditingInfo(false)\n    onOpenChange(false)\n  }\n\n  const cancelEditInfo = () => {\n    setIsEditingInfo(false)\n    setEditedLead({\n      nome: lead.nome || '',\n      email: lead.email || '',\n      celular: lead.celular || '',\n      origem: lead.origem || '',\n      tipo_consorcio: lead.tipo_consorcio || '',\n      valor_projeto: typeof lead.valor_projeto === 'number' ? lead.valor_projeto : null,\n      lead_rating: typeof lead.lead_rating === 'number' ? lead.lead_rating : null,\n    })\n  }\n\n  const handleStatusChange = (newStatus: string) => {\n    onUpdate(lead.id, { status_lead: newStatus as Contact['status_lead'] })\n  }\n\n  const handleArchiveLead = () => {\n    if (!confirm('Tem certeza que deseja arquivar este lead?')) return\n    onUpdate(lead.id, { status_lead: 'perdido' })\n    onOpenChange(false)\n  }\n\n  const handleConvertLead = () => {\n    onRequestConvertWithCotas(lead)\n    onOpenChange(false)\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-gray-100 bg-opacity-90 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col\">\n        <div className=\"flex items-center justify-between p-6 border-b\">\n          <div>\n            <h3 className=\"text-xl font-semibold\">Lead: {lead.nome}</h3>\n            <p className=\"text-gray-600 text-sm\">Detalhes, edição e timeline</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {lead.status_lead !== 'perdido' && lead.status_lead !== 'convertido' && (\n              <Button size=\"sm\" variant=\"outline\" onClick={handleArchiveLead} disabled={loading} className=\"text-gray-600 hover:text-gray-900\">\n                <Archive className=\"h-4 w-4 mr-2\" />\n                Arquivar\n              </Button>\n            )}\n            {lead.status_lead !== 'convertido' && (\n              <Button size=\"sm\" onClick={handleConvertLead} disabled={loading}>\n                Converter em Cliente\n              </Button>\n            )}\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => onOpenChange(false)} disabled={loading}>\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          <div className=\"grid grid-cols-2 gap-6 w-full\">\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h4 className=\"text-sm font-medium\">Detalhes</h4>\n                  {!isEditingInfo && (\n                    <Button size=\"sm\" variant=\"outline\" onClick={startEditingInfo} className=\"text-xs\" disabled={loading}>\n                      <Edit className=\"h-3 w-3 mr-1\" />\n                      Editar\n                    </Button>\n                  )}\n                  {isEditingInfo && (\n                    <Button size=\"sm\" variant=\"outline\" onClick={cancelEditInfo} className=\"text-xs\" disabled={loading}>\n                      <X className=\"h-3 w-3 mr-1\" />\n                      Cancelar\n                    </Button>\n                  )}\n                </div>\n\n                {isEditingInfo ? (\n                  <div className=\"space-y-3 text-sm\">\n                    <div>\n                      <Label className=\"text-xs text-muted-foreground\">Potencial (1–5):</Label>\n                      <Select\n                        value={editedLead.lead_rating === null || editedLead.lead_rating === undefined ? 'null' : String(editedLead.lead_rating)}\n                        onValueChange={(v) =>\n                          setEditedLead({\n                            ...editedLead,\n                            lead_rating: v === 'null' ? null : parseInt(v, 10),\n                          })\n                        }\n                      >\n                        <SelectTrigger className=\"h-8 mt-1\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"null\">Sem avaliação</SelectItem>\n                          <SelectItem value=\"5\">5</SelectItem>\n                          <SelectItem value=\"4\">4</SelectItem>\n                          <SelectItem value=\"3\">3</SelectItem>\n                          <SelectItem value=\"2\">2</SelectItem>\n                          <SelectItem value=\"1\">1</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <div className=\"text-xs text-muted-foreground mt-1\">1 = pouco interessante, 5 = muito potencial</div>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex items-center\">\n                      <span className=\"text-muted-foreground\">Potencial:</span>\n                      <Select\n                        value={lead.lead_rating === null || lead.lead_rating === undefined ? 'null' : String(lead.lead_rating)}\n                        onValueChange={async (v) => {\n                          const newRating = v === 'null' ? null : parseInt(v, 10)\n                          await onUpdate(lead.id, { lead_rating: newRating } as Partial<Contact>)\n                        }}\n                      >\n                        <SelectTrigger className=\"h-8 ml-2 inline-flex w-[160px]\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"null\">Sem avaliação</SelectItem>\n                          <SelectItem value=\"5\">5</SelectItem>\n                          <SelectItem value=\"4\">4</SelectItem>\n                          <SelectItem value=\"3\">3</SelectItem>\n                          <SelectItem value=\"2\">2</SelectItem>\n                          <SelectItem value=\"1\">1</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div className=\"space-y-4\">\n              <ActivityTimeline contactId={lead.id} />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t p-4 flex justify-end\">\n          <Button \n            onClick={saveLeadInfo} \n            disabled={loading}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            Salvar\n          </Button>\n        </div>\n      </div>\n    </div>\n  )\n}",
            "language": "typescript",
            "title": "Lead Modal with Rating Editor",
            "order": 1
          }
        ]
      },
      {
        "name": "Leads Page - Rating Filter Logic",
        "description": "Página principal de leads com lógica de filtro por rating aplicado aos leads",
        "route": "frontend/src/app/dashboard/leads/page.tsx",
        "blocks": [
          {
            "id": "block-4",
            "type": "code",
            "content": "// Trecho relevante da página de leads que implementa o filtro de rating\n\nconst [ratingFilter, setRatingFilter] = useState<string>('all')\n\nconst searchedLeads = useMemo(() => {\n  let filtered = leads\n\n  // Filtrar leads arquivados (status 'perdido')\n  filtered = filtered.filter(lead => lead.status_lead !== 'perdido')\n\n  // Apply consultant filter\n  if (consultorFilter === 'mine' && profile?.id) {\n    filtered = filtered.filter(lead => lead.consultor_responsavel === profile.id)\n  } else if (consultorFilter === 'unassigned') {\n    filtered = filtered.filter(lead => !lead.consultor_responsavel)\n  } else if (consultorFilter !== 'all') {\n    filtered = filtered.filter(lead => lead.consultor_responsavel === consultorFilter)\n  }\n\n  // Apply rating filter (client-side for now)\n  if (ratingFilter !== 'all') {\n    const r = parseInt(ratingFilter, 10)\n    if (!Number.isNaN(r)) {\n      filtered = filtered.filter(lead => lead.lead_rating === r)\n    }\n  }\n\n  // Apply search filter\n  const normalizedSearch = searchTerm.toLowerCase()\n  filtered = filtered.filter((lead) => {\n    const nome = (lead.nome ?? '').toLowerCase()\n    const email = (lead.email ?? '').toLowerCase()\n    const celular = lead.celular ?? ''\n    return (\n      nome.includes(normalizedSearch) ||\n      email.includes(normalizedSearch) ||\n      celular.includes(searchTerm)\n    )\n  })\n\n  return filtered\n}, [leads, searchTerm, consultorFilter, profile?.id, ratingFilter])\n\n// Uso no JSX\n<LeadFilters\n  searchTerm={searchTerm}\n  onSearchChange={setSearchTerm}\n  categoryFilter={categoryFilter}\n  onCategoryFilterChange={setCategoryFilter}\n  consultorFilter={consultorFilter}\n  onConsultorFilterChange={setConsultorFilter}\n  ratingFilter={ratingFilter}\n  onRatingFilterChange={setRatingFilter}\n  team={team}\n  currentProfile={profile}\n  onCreateLead={handleCreateLead}\n/>",
            "language": "typescript",
            "title": "Rating Filter Logic",
            "order": 1
          }
        ]
      },
      {
        "name": "Backend - Contact Model Rating Query",
        "description": "Lógica de query no modelo Contact para filtrar leads por rating no backend",
        "route": "backend/src/models/Contact.js",
        "blocks": [
          {
            "id": "block-5",
            "type": "code",
            "content": "// Trecho do modelo Contact.js que implementa filtro de rating\n\n// No método findLeads ou findContacts\nif (filters.rating) {\n  const parts = String(filters.rating)\n    .split(',')\n    .map(s => parseInt(s.trim(), 10))\n    .filter(n => Number.isInteger(n) && n >= 1 && n <= 5);\n  if (parts.length > 0) {\n    query = query.in('lead_rating', parts);\n  }\n}\n\n// Aplicar paginação\nquery = paginate(query, pagination.page, pagination.limit);\n\nreturn executeQuery(query);",
            "language": "javascript",
            "title": "Contact Model Rating Filter",
            "order": 1
          }
        ]
      },
      {
        "name": "Backend - Contacts Controller Rating Validation",
        "description": "Validação do campo lead_rating no controller de contatos, garantindo valores entre 1-5 ou null",
        "route": "backend/src/controllers/contactsController.js",
        "blocks": [
          {
            "id": "block-6",
            "type": "code",
            "content": "// Trecho do controller de contatos que valida lead_rating\n\nconst updateById = async (req, res) => {\n  try {\n    const id = Number(req.params.id);\n    const {\n      nome,\n      celular,\n      email,\n      origem,\n      tipo_consorcio,\n      status_lead,\n      status_cliente,\n      tipo_contato,\n      comentarios,\n      consultor_responsavel,\n      cotas,\n      valor_projeto,\n      lead_rating\n    } = req.body;\n\n    // Validar lead_rating quando fornecido (1-5 ou null)\n    if (lead_rating !== undefined && lead_rating !== null) {\n      const n = Number(lead_rating);\n      if (!Number.isInteger(n) || n < 1 || n > 5) {\n        return res.status(400).json({ error: 'lead_rating deve ser um inteiro entre 1 e 5' });\n      }\n    }\n\n    // Validar cotas se fornecido\n    if (cotas !== undefined && !Array.isArray(cotas)) {\n      return res.status(400).json({ error: 'Campo cotas deve ser um array' });\n    }\n\n    // Delega para updateContact que detecta cliente→lead\n    const updated = await ContactService.updateContact(id, {\n      nome,\n      celular,\n      email,\n      origem,\n      tipo_consorcio,\n      status_lead,\n      status_cliente,\n      tipo_contato,\n      comentarios,\n      consultor_responsavel,\n      cotas,\n      valor_projeto,\n      lead_rating\n    }, req.user.team_id);\n    \n    return res.json(updated);\n  } catch (error) {\n    console.error('Error updating contact:', error);\n    return res.status(500).json({ error: error.message || 'Supabase error' });\n  }\n};",
            "language": "javascript",
            "title": "Rating Validation in Controller",
            "order": 1
          }
        ]
      },
      {
        "name": "Frontend - API Types",
        "description": "Definição do tipo Contact com campo lead_rating na API do frontend",
        "route": "frontend/src/services/contacts-api.ts",
        "blocks": [
          {
            "id": "block-7",
            "type": "code",
            "content": "// Trecho da definição de tipos na API de contatos\n\nexport interface Contact {\n  id: number\n  team_id: string\n  tipo_contato: 'lead' | 'cliente'\n  nome: string\n  email: string\n  celular: string\n  origem?: string\n  tipo_consorcio?: 'automovel' | 'imovel' | 'servicos' | 'imovel_e_automovel' | 'outros'\n  status_lead?: 'novo' | 'em_contato' | 'qualificado' | 'proposta_enviada' | 'negociacao' | 'perdido' | 'convertido' | 'no_show' | 'contorno_objecoes' | 'possiveis_investidores' | 'primeira_reuniao' | 'segunda_reuniao' | 'green_flag' | 'documentacao'\n  status_cliente?: 'ativo' | 'inativo'\n  consultor_responsavel?: string\n  comentarios?: string\n  data_conversao?: string\n  created_at: string\n  updated_at: string\n  // Rating de potencial do lead (1–5)\n  lead_rating?: number | null\n  // Campos específicos para recebimentos (quando é cliente)\n  valorTotalContratado?: number | null\n  statusPagamento?: 'em_dia' | 'pendente' | 'atrasado'\n  // Valor do projeto (para leads)\n  valor_projeto?: number | null\n}",
            "language": "typescript",
            "title": "Contact Type with Rating",
            "order": 1
          }
        ]
      },
      {
        "name": "Configuração",
        "description": "Informações sobre a estrutura do sistema de rating e como utilizá-lo",
        "blocks": [
          {
            "id": "block-8",
            "type": "text",
            "content": "O sistema de Lead Rating permite avaliar o potencial de cada lead em uma escala de 1 a 5 estrelas:\n\n- 1 estrela: Lead com pouco potencial ou baixo interesse\n- 2 estrelas: Lead com potencial moderado\n- 3 estrelas: Lead com bom potencial\n- 4 estrelas: Lead com alto potencial (aparece badge visual no card)\n- 5 estrelas: Lead com altíssimo potencial (aparece badge visual no card)\n\nLeads com rating >= 4 recebem um badge visual destacado em amarelo/dourado com ícone de estrela nos cards da visualização kanban.\n\nO rating pode ser:\n- Definido ao criar/editar o lead no modal\n- Alterado rapidamente via dropdown inline no modal de detalhes\n- Filtrado usando os chips de estrelas na barra de filtros\n- Armazenado como número inteiro (1-5) ou null no banco de dados",
            "title": "Como funciona o Lead Rating",
            "order": 1
          },
          {
            "id": "block-9",
            "type": "text",
            "content": "Para adicionar a coluna lead_rating no banco de dados Supabase, execute o seguinte SQL:\n\nALTER TABLE contacts \nADD COLUMN IF NOT EXISTS lead_rating INTEGER CHECK (lead_rating >= 1 AND lead_rating <= 5);\n\nCREATE INDEX IF NOT EXISTS idx_contacts_lead_rating \nON contacts(lead_rating) \nWHERE lead_rating IS NOT NULL;",
            "title": "Migração do Banco de Dados",
            "order": 2
          },
          {
            "id": "block-10",
            "type": "terminal",
            "content": "npm install lucide-react date-fns\nnpm install @dnd-kit/core",
            "title": "Instalar dependências",
            "order": 3
          }
        ]
      }
    ]
  }