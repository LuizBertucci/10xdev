{
  "id": "azure-ssl-dominios-customizados",
  "title": "Configurar SSL para Domínios Customizados no Azure App Service",
  "tech": "Azure",
  "language": "bash",
  "description": "Guia completo para configurar certificados SSL gerenciados para domínios customizados no Azure App Service usando Azure CLI",
  "content_type": "code",
  "card_type": "codigos",
  "screens": [
    {
      "name": "Pré-requisitos",
      "description": "Requisitos necessários antes de configurar SSL",
      "route": "cards/azure-ssl-dominios-customizados/pre-requisitos",
      "order": 0,
      "blocks": [
        {
          "id": "prereq-1",
          "type": "text",
          "title": "Pré-requisitos",
          "language": "text",
          "order": 0,
          "content": "Antes de configurar SSL para domínios customizados no Azure App Service, você precisa:\n\n1. **Azure CLI instalado e configurado**\n   - Faça login com: `az login`\n   - Verifique com: `az account show`\n\n2. **App Service Plan no mínimo Basic (B1)**\n   - Certificados gerenciados gratuitos só funcionam em planos Basic ou superiores\n   - Planos Free e Shared não suportam certificados gerenciados\n\n3. **Domínios customizados já adicionados aos Web Apps**\n   - Os domínios devem estar configurados no DNS\n   - Devem estar vinculados aos Web Apps do Azure\n\n4. **Registros DNS configurados corretamente**\n   - Registro A ou CNAME apontando para o Azure\n   - Registros TXT de verificação (asuid.*) configurados\n\n5. **Permissões adequadas no Azure**\n   - Contribuidor ou Owner no Resource Group\n   - Acesso para criar e gerenciar certificados"
        },
        {
          "id": "prereq-2",
          "type": "text",
          "title": "Verificar Plano do App Service",
          "language": "text",
          "order": 1,
          "content": "IMPORTANTE: Certificados SSL gerenciados gratuitos do Azure só funcionam em planos Basic (B1) ou superiores.\n\nSe seu plano for Free (F1) ou Shared, você precisará atualizar para Basic antes de continuar.\n\nO comando para verificar o plano atual está na próxima tela."
        }
      ]
    },
    {
      "name": "Verificações Iniciais",
      "description": "Comandos para verificar Web Apps e configurações",
      "route": "cards/azure-ssl-dominios-customizados/verificacoes",
      "order": 1,
      "blocks": [
        {
          "id": "verify-1",
          "type": "terminal",
          "title": "Listar Web Apps no Resource Group",
          "language": "bash",
          "order": 0,
          "content": "az webapp list --resource-group resource-10xdev --query \"[].{name:name, defaultHostName:defaultHostName}\" --output table"
        },
        {
          "id": "verify-2",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 1,
          "content": "Lista todos os Web Apps no resource group especificado, mostrando o nome e o hostname padrão de cada um.\n\nUse este comando para confirmar os nomes corretos dos seus Web Apps antes de configurar SSL."
        },
        {
          "id": "verify-3",
          "type": "terminal",
          "title": "Verificar Plano do App Service",
          "language": "bash",
          "order": 2,
          "content": "az appservice plan show --resource-group resource-10xdev --name app-plan-10xdev --query \"{name:name, sku:sku}\" --output json"
        },
        {
          "id": "verify-4",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 3,
          "content": "Verifica o plano atual do App Service Plan.\n\nRetorna o nome e o SKU (tier) do plano. Se o tier for \"Free\" ou \"Shared\", você precisará atualizar para \"Basic\" antes de criar certificados SSL.\n\nExemplo de resposta:\n- Free: `{\"tier\": \"Free\", \"name\": \"F1\"}`\n- Basic: `{\"tier\": \"Basic\", \"name\": \"B1\"}`"
        },
        {
          "id": "verify-5",
          "type": "terminal",
          "title": "Atualizar Plano para Basic (se necessário)",
          "language": "bash",
          "order": 4,
          "content": "az appservice plan update --resource-group resource-10xdev --name app-plan-10xdev --sku B1"
        },
        {
          "id": "verify-6",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 5,
          "content": "Atualiza o App Service Plan para o SKU B1 (Basic).\n\nEste comando é necessário se seu plano atual for Free ou Shared.\n\n⚠️ ATENÇÃO: Esta mudança gera custos. O plano Basic é pago.\n\nApós executar, aguarde alguns segundos para a atualização ser processada antes de criar certificados."
        },
        {
          "id": "verify-7",
          "type": "terminal",
          "title": "Verificar Domínios Customizados Configurados",
          "language": "bash",
          "order": 6,
          "content": "az webapp config hostname list --resource-group resource-10xdev --webapp-name web-backend-10xdev --output table"
        },
        {
          "id": "verify-8",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 7,
          "content": "Lista todos os hostnames (domínios) configurados para um Web App específico.\n\nUse este comando para verificar se seus domínios customizados já foram adicionados ao Web App antes de configurar SSL.\n\nSubstitua `web-backend-10xdev` pelo nome do seu Web App."
        }
      ]
    },
    {
      "name": "Obter Informações de Verificação",
      "description": "Comandos para obter IDs de verificação e IPs",
      "route": "cards/azure-ssl-dominios-customizados/verificacao",
      "order": 2,
      "blocks": [
        {
          "id": "info-1",
          "type": "terminal",
          "title": "Obter ID de Verificação do Domínio",
          "language": "bash",
          "order": 0,
          "content": "az webapp show --resource-group resource-10xdev --name web-backend-10xdev --query \"customDomainVerificationId\" --output tsv"
        },
        {
          "id": "info-2",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 1,
          "content": "Retorna o ID de verificação necessário para configurar os registros TXT no DNS.\n\nEste ID deve ser usado no registro TXT com o nome `asuid.<seu-dominio>`.\n\nExemplo: Se o ID retornado for `CFEDB5E16BB9D12BBAC52160B732AE291E0C620B16B33054F0F87642EDA7E874`, você deve criar um registro TXT:\n- Nome: `asuid.api.10xdev.com.br`\n- Valor: `cfedb5e16bb9d12bbac52160b732ae291e0c620b16b33054f0f87642eda7e874`\n\n⚠️ O valor deve estar em minúsculas e sem aspas no DNS."
        },
        {
          "id": "info-3",
          "type": "terminal",
          "title": "Obter IP Externo do Web App",
          "language": "bash",
          "order": 2,
          "content": "az webapp config hostname get-external-ip --resource-group resource-10xdev --webapp-name web-backend-10xdev --output tsv"
        },
        {
          "id": "info-4",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 3,
          "content": "Retorna o IP externo do Web App.\n\nUse este IP para configurar o registro A no DNS se estiver usando registro A ao invés de CNAME.\n\nExemplo de resposta: `20.206.176.3`\n\nEste IP deve ser usado no registro A do domínio raiz (ex: `10xdev.com.br`)."
        }
      ]
    },
    {
      "name": "Adicionar Domínios Customizados",
      "description": "Comandos para adicionar domínios aos Web Apps",
      "route": "cards/azure-ssl-dominios-customizados/adicionar-dominios",
      "order": 3,
      "blocks": [
        {
          "id": "add-1",
          "type": "terminal",
          "title": "Adicionar Domínio ao Backend",
          "language": "bash",
          "order": 0,
          "content": "az webapp config hostname add --resource-group resource-10xdev --webapp-name web-backend-10xdev --hostname api.10xdev.com.br"
        },
        {
          "id": "add-2",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 1,
          "content": "Adiciona um domínio customizado ao Web App do backend.\n\nEste comando verifica se os registros DNS estão configurados corretamente:\n- Verifica se existe registro CNAME ou A apontando para o Azure\n- Verifica se existe registro TXT `asuid.<dominio>` com o ID de verificação correto\n\n⚠️ Se der erro, verifique:\n1. Se os registros DNS foram propagados (pode levar alguns minutos)\n2. Se o registro TXT está correto e sem aspas\n3. Se o CNAME aponta para o Web App correto\n\nSubstitua `api.10xdev.com.br` pelo seu domínio."
        },
        {
          "id": "add-3",
          "type": "terminal",
          "title": "Adicionar Domínio WWW ao Frontend",
          "language": "bash",
          "order": 2,
          "content": "az webapp config hostname add --resource-group resource-10xdev --webapp-name web-frontend-10xdev --hostname www.10xdev.com.br"
        },
        {
          "id": "add-4",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 3,
          "content": "Adiciona o domínio www ao Web App do frontend.\n\nMesma verificação de DNS do comando anterior.\n\nSubstitua `www.10xdev.com.br` pelo seu domínio."
        },
        {
          "id": "add-5",
          "type": "terminal",
          "title": "Adicionar Domínio Raiz ao Frontend",
          "language": "bash",
          "order": 4,
          "content": "az webapp config hostname add --resource-group resource-10xdev --webapp-name web-frontend-10xdev --hostname 10xdev.com.br"
        },
        {
          "id": "add-6",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 5,
          "content": "Adiciona o domínio raiz (sem www) ao Web App do frontend.\n\nPara domínios raiz, você precisa de um registro A apontando para o IP do Azure (obtido com o comando anterior).\n\nSubstitua `10xdev.com.br` pelo seu domínio raiz."
        }
      ]
    },
    {
      "name": "Criar Certificados SSL",
      "description": "Comandos para criar certificados SSL gerenciados",
      "route": "cards/azure-ssl-dominios-customizados/criar-certificados",
      "order": 4,
      "blocks": [
        {
          "id": "cert-1",
          "type": "terminal",
          "title": "Criar Certificado SSL para API",
          "language": "bash",
          "order": 0,
          "content": "az webapp config ssl create --resource-group resource-10xdev --name web-backend-10xdev --hostname api.10xdev.com.br"
        },
        {
          "id": "cert-2",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 1,
          "content": "Cria um certificado SSL gerenciado gratuito do Azure para o domínio especificado.\n\nEste comando:\n- Cria automaticamente um certificado SSL/TLS\n- É gerenciado pelo Azure (renovação automática)\n- É gratuito para planos Basic ou superiores\n- Válido por 1 ano (renovado automaticamente)\n\n⚠️ IMPORTANTE: Anote o `thumbprint` retornado na resposta. Você precisará dele para vincular o certificado.\n\nExemplo de thumbprint: `586E82EB0C4D41F66A6C1D3FE0647A89DBCC3ED2`"
        },
        {
          "id": "cert-3",
          "type": "terminal",
          "title": "Criar Certificado SSL para WWW",
          "language": "bash",
          "order": 2,
          "content": "az webapp config ssl create --resource-group resource-10xdev --name web-frontend-10xdev --hostname www.10xdev.com.br"
        },
        {
          "id": "cert-4",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 3,
          "content": "Cria certificado SSL para o domínio www.\n\nMesmo processo do comando anterior. Anote o thumbprint retornado."
        },
        {
          "id": "cert-5",
          "type": "terminal",
          "title": "Criar Certificado SSL para Domínio Raiz",
          "language": "bash",
          "order": 4,
          "content": "az webapp config ssl create --resource-group resource-10xdev --name web-frontend-10xdev --hostname 10xdev.com.br"
        },
        {
          "id": "cert-6",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 5,
          "content": "Cria certificado SSL para o domínio raiz.\n\nMesmo processo. Anote o thumbprint retornado.\n\n⚠️ Você pode criar múltiplos certificados para o mesmo Web App (um para cada domínio)."
        }
      ]
    },
    {
      "name": "Vincular Certificados SSL",
      "description": "Comandos para vincular certificados aos domínios",
      "route": "cards/azure-ssl-dominios-customizados/vincular-certificados",
      "order": 5,
      "blocks": [
        {
          "id": "bind-1",
          "type": "terminal",
          "title": "Vincular Certificado ao Domínio da API",
          "language": "bash",
          "order": 0,
          "content": "az webapp config ssl bind --resource-group resource-10xdev --name web-backend-10xdev --certificate-thumbprint 586E82EB0C4D41F66A6C1D3FE0647A89DBCC3ED2 --ssl-type SNI --hostname api.10xdev.com.br"
        },
        {
          "id": "bind-2",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 1,
          "content": "Vincula o certificado SSL criado ao domínio customizado.\n\nParâmetros:\n- `--certificate-thumbprint`: Thumbprint do certificado obtido no passo anterior\n- `--ssl-type SNI`: Usa Server Name Indication (suporta múltiplos certificados no mesmo IP)\n- `--hostname`: Domínio ao qual vincular o certificado\n\n⚠️ Substitua o thumbprint pelo valor retornado quando você criou o certificado.\n\nApós vincular, o domínio estará acessível via HTTPS."
        },
        {
          "id": "bind-3",
          "type": "terminal",
          "title": "Vincular Certificado ao Domínio WWW",
          "language": "bash",
          "order": 2,
          "content": "az webapp config ssl bind --resource-group resource-10xdev --name web-frontend-10xdev --certificate-thumbprint 879285B80474BE458B9B1420DC36F7A4E984E637 --ssl-type SNI --hostname www.10xdev.com.br"
        },
        {
          "id": "bind-4",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 3,
          "content": "Vincula certificado ao domínio www.\n\nUse o thumbprint do certificado criado para www.\n\nSubstitua o thumbprint pelo valor correto."
        },
        {
          "id": "bind-5",
          "type": "terminal",
          "title": "Vincular Certificado ao Domínio Raiz",
          "language": "bash",
          "order": 4,
          "content": "az webapp config ssl bind --resource-group resource-10xdev --name web-frontend-10xdev --certificate-thumbprint 3D18A87F0DF6221F12A8D717E817FC6EA40E74F2 --ssl-type SNI --hostname 10xdev.com.br"
        },
        {
          "id": "bind-6",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 5,
          "content": "Vincula certificado ao domínio raiz.\n\nUse o thumbprint do certificado criado para o domínio raiz.\n\nSubstitua o thumbprint pelo valor correto."
        }
      ]
    },
    {
      "name": "Verificar e Testar",
      "description": "Comandos para verificar se SSL está funcionando",
      "route": "cards/azure-ssl-dominios-customizados/verificar",
      "order": 6,
      "blocks": [
        {
          "id": "test-1",
          "type": "terminal",
          "title": "Verificar Status SSL dos Domínios",
          "language": "bash",
          "order": 0,
          "content": "az webapp config hostname list --resource-group resource-10xdev --webapp-name web-backend-10xdev --query \"[?contains(name, '10xdev.com.br')]\" --output table"
        },
        {
          "id": "test-2",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 1,
          "content": "Lista apenas os domínios customizados (filtra por nome) para verificar se estão configurados.\n\nUse este comando para confirmar que os domínios foram adicionados corretamente."
        },
        {
          "id": "test-3",
          "type": "terminal",
          "title": "Testar SSL com cURL (OPTIONS)",
          "language": "bash",
          "order": 2,
          "content": "curl -X OPTIONS https://api.10xdev.com.br/api/projects -H \"Origin: https://10xdev.com.br\" -H \"Access-Control-Request-Method: GET\" -i"
        },
        {
          "id": "test-4",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 3,
          "content": "Testa se o SSL está funcionando e se os headers CORS estão corretos.\n\nEste comando faz um preflight request (OPTIONS) para verificar:\n- Se o certificado SSL está válido\n- Se os headers CORS estão sendo retornados corretamente\n- Se `access-control-allow-origin` está presente na resposta\n\nSe tudo estiver correto, você verá headers como:\n- `access-control-allow-origin: https://10xdev.com.br`\n- `access-control-allow-credentials: true`"
        },
        {
          "id": "test-5",
          "type": "terminal",
          "title": "Testar SSL com cURL (GET)",
          "language": "bash",
          "order": 4,
          "content": "curl -X GET https://api.10xdev.com.br/api/health -H \"Origin: https://10xdev.com.br\" -i"
        },
        {
          "id": "test-6",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 5,
          "content": "Testa uma requisição GET real para verificar se o SSL está funcionando em requisições normais.\n\nVerifica se:\n- A conexão HTTPS está estabelecida\n- O certificado é válido\n- Os headers CORS estão presentes nas respostas GET também"
        }
      ]
    },
    {
      "name": "Troubleshooting",
      "description": "Soluções para problemas comuns",
      "route": "cards/azure-ssl-dominios-customizados/troubleshooting",
      "order": 7,
      "blocks": [
        {
          "id": "trouble-1",
          "type": "text",
          "title": "Erro: Managed Certificate is not supported",
          "language": "text",
          "order": 0,
          "content": "**Problema:** Erro ao criar certificado: \"Managed Certificate is not supported on Free and Shared tier\"\n\n**Solução:**\n1. Verifique o plano atual: `az appservice plan show --resource-group <rg> --name <plan-name> --query sku`\n2. Se for Free ou Shared, atualize para Basic: `az appservice plan update --resource-group <rg> --name <plan-name> --sku B1`\n3. Aguarde alguns segundos e tente criar o certificado novamente"
        },
        {
          "id": "trouble-2",
          "type": "text",
          "title": "Erro: TXT record not found",
          "language": "text",
          "order": 1,
          "content": "**Problema:** Erro ao adicionar domínio: \"A TXT record pointing from asuid.<dominio> to <id> was not found\"\n\n**Soluções:**\n1. Verifique se o registro TXT foi criado no DNS\n2. Confirme que o valor está correto (sem aspas, em minúsculas)\n3. Aguarde a propagação DNS (pode levar até 48 horas, mas geralmente é rápido)\n4. Use `dig TXT asuid.<seu-dominio>` ou `nslookup -type=TXT asuid.<seu-dominio>` para verificar se o DNS está propagado\n5. Verifique se o ID de verificação está correto: `az webapp show --resource-group <rg> --name <app-name> --query customDomainVerificationId`"
        },
        {
          "id": "trouble-3",
          "type": "text",
          "title": "Erro: Certificate for thumbprint not found",
          "language": "text",
          "order": 2,
          "content": "**Problema:** Erro ao vincular certificado: \"Certificate for thumbprint '' not found\"\n\n**Soluções:**\n1. Certifique-se de que o certificado foi criado com sucesso\n2. Verifique se o thumbprint está correto (copie exatamente como retornado)\n3. O thumbprint deve estar em MAIÚSCULAS\n4. Liste os certificados criados: `az webapp config ssl list --resource-group <rg> --query \"[].{name:name, thumbprint:thumbprint}\"`\n5. Use o thumbprint correto do certificado listado"
        },
        {
          "id": "trouble-4",
          "type": "text",
          "title": "SSL não funciona após vincular",
          "language": "text",
          "order": 3,
          "content": "**Problema:** Certificado vinculado mas HTTPS não funciona\n\n**Soluções:**\n1. Aguarde alguns minutos para a propagação\n2. Limpe o cache do navegador\n3. Verifique se o domínio está na lista de hostnames: `az webapp config hostname list --resource-group <rg> --webapp-name <app-name>`\n4. Verifique o status SSL: `az webapp config ssl list --resource-group <rg> --query \"[?contains(hostNames, '<dominio>')]\"`\n5. Reinicie o Web App: `az webapp restart --resource-group <rg> --name <app-name>`"
        },
        {
          "id": "trouble-5",
          "type": "terminal",
          "title": "Reiniciar Web App",
          "language": "bash",
          "order": 4,
          "content": "az webapp restart --resource-group resource-10xdev --name web-backend-10xdev"
        },
        {
          "id": "trouble-6",
          "type": "text",
          "title": "O que faz este comando",
          "language": "text",
          "order": 5,
          "content": "Reinicia o Web App.\n\nUse este comando se houver problemas após configurar SSL ou se mudanças não estiverem sendo aplicadas.\n\nSubstitua pelos nomes corretos do seu resource group e Web App."
        }
      ]
    }
  ]
}
